{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/daflan-org/fawa-compliance-evidence/main/schemas/test-artifact.schema.json",
  "title": "ComplianceTestArtifact",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "testId",
    "sourcePath",
    "suiteType",
    "result",
    "executedAt",
    "assertions"
  ],
  "properties": {
    "schemaVersion": { "type": "string", "minLength": 1 },
    "testId": { "type": "string", "minLength": 1 },
    "sourcePath": { "type": "string", "minLength": 1 },
    "suiteType": { "type": "string", "enum": ["unit", "e2e"] },
    "result": { "type": "string", "enum": ["passed", "failed"] },
    "executedAt": { "type": "string", "format": "date-time" },
    "runId": { "type": "string", "minLength": 1 },
    "jobName": { "type": "string", "minLength": 1 },
    "sourceCommitSha": { "type": "string", "minLength": 7 },
    "workflowPath": { "type": "string", "minLength": 1 },
    "assertions": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/assertion" }
    }
  },
  "$defs": {
    "assertion": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "assertionId",
        "name",
        "status",
        "expected",
        "actual",
        "evidenceRef",
        "verifiedAt"
      ],
      "properties": {
        "assertionId": { "type": "string", "minLength": 1 },
        "name": { "type": "string", "minLength": 1 },
        "status": { "type": "string", "enum": ["passed", "failed"] },
        "expected": { "type": "string", "minLength": 1 },
        "actual": { "type": "string", "minLength": 1 },
        "evidenceRef": {
          "type": "object",
          "additionalProperties": false,
          "required": ["filePath", "matcherType", "matcher"],
          "properties": {
            "filePath": { "type": "string", "minLength": 1 },
            "matcherType": { "type": "string", "enum": ["includes", "regex"] },
            "matcher": { "type": "string", "minLength": 1 }
          }
        },
        "verifiedAt": { "type": "string", "format": "date-time" }
      }
    }
  }
}
